{% extends "admin_base.html" %}
{% block title %}PDF DokuCheck - Admin Dashboard{% endblock %}
{% block header_right %}
<button type="button" class="btn btn-secondary btn-small" id="btn-git-pull" onclick="doGitPull()" title="St√°hnout z GitHubu">&#128260; St√°hnout z GitHubu</button>
<a href="{{ url_for('admin.settings') }}" class="btn btn-secondary btn-small">Global Config</a>
{% endblock %}
{% block content %}
<div class="actions-bar" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:12px;">
    <h2 style="font-size:1.1em;margin:0;">U≈æivatel√©</h2>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <form method="get" action="{{ url_for('admin.dashboard') }}" style="display:flex;gap:6px;align-items:center;">
            <input type="hidden" name="tier" value="{{ tier_filter }}">
            <input type="hidden" name="status" value="{{ status_filter }}">
            <input type="text" name="q" class="form-control" style="width:160px;" placeholder="Vyhledat (e-mail, jm√©no)‚Ä¶" value="{{ search }}">
            <button type="submit" class="btn btn-sm btn-secondary">Hledat</button>
        </form>
        <form method="get" action="{{ url_for('admin.dashboard') }}" style="display:flex;gap:6px;align-items:center;">
            <input type="hidden" name="q" value="{{ search }}">
            <input type="hidden" name="status" value="{{ status_filter }}">
            <select name="tier" class="form-control form-select" style="width:120px;" onchange="this.form.submit()">
                <option value="">V≈°echny tarify</option>
                {% for t in tiers_list %}
                <option value="{{ t.name }}" {{ 'selected' if tier_filter == t.name else '' }}>{{ t.name }}</option>
                {% endfor %}
            </select>
        </form>
        <form method="get" action="{{ url_for('admin.dashboard') }}" style="display:flex;gap:6px;align-items:center;">
            <input type="hidden" name="q" value="{{ search }}">
            <input type="hidden" name="tier" value="{{ tier_filter }}">
            <select name="status" class="form-control form-select" style="width:110px;" onchange="this.form.submit()">
                <option value="">Stav √∫ƒçtu</option>
                <option value="active" {{ 'selected' if status_filter == 'active' else '' }}>Aktivn√≠</option>
                <option value="blocked" {{ 'selected' if status_filter == 'blocked' else '' }}>Blokovan√Ω</option>
            </select>
        </form>
        <button class="btn btn-primary btn-sm" onclick="openCreateModal()">+ Nov√° licence</button>
    </div>
</div>

<div class="table-container">
    <table class="table-dense">
        <thead>
            <tr>
                <th>E-mail / Jm√©no</th>
                <th>Tarif</th>
                <th>Za≈ô√≠zen√≠</th>
                <th>Posledn√≠ aktivita</th>
                <th>Soubory</th>
                <th>Platba</th>
                <th>Akce</th>
            </tr>
        </thead>
        <tbody>
            {% for license in licenses %}
            <tr data-api-key="{{ license.api_key }}" data-tier-id="{{ license.tier_id or '' }}" data-email="{{ (license.email or '')|e }}" data-user-name="{{ (license.user_name or '')|e }}" data-license-expires="{{ license.license_expires or '' }}" data-is-active="{{ 1 if license.is_active else 0 }}" data-payment-method="{{ (license.payment_method or '')|e }}" data-last-payment-date="{{ license.last_payment_date or '' }}">
                <td>
                    <strong>{{ license.email or '‚Äî' }}</strong>
                    {% if license.user_name and license.user_name != license.email %}<br><small style="color:#6b7280;">{{ license.user_name }}</small>{% endif %}
                </td>
                <td><span class="badge badge-{{ license.tier_name|lower }}">{{ license.tier_name }}</span></td>
                <td>{{ license.active_devices }}/{{ license.max_devices if license.max_devices and license.max_devices != -1 else '‚àû' }}</td>
                <td><small>{% if license.last_active %}{{ license.last_active[:16] }}{% else %}‚Äî{% endif %}</small></td>
                <td>{{ license.total_checks }}</td>
                <td><small>{{ license.payment_method or '‚Äî' }}<br>{{ (license.last_payment_date or '‚Äî')[:10] }}</small></td>
                <td>
                    <div class="actions-cell">
                        <button class="action-btn primary-btn" onclick="openEditModalFromRow(this.closest('tr'))" title="Upravit / Prodlou≈æit licenci">PRODLOU≈ΩIT</button>
                        <button class="action-btn" onclick="toggleLicense('{{ license.api_key }}', {{ 'false' if license.is_active else 'true' }})" title="{{ 'Deaktivovat licenci' if license.is_active else 'Aktivovat' }}">{{ 'DEAKTIVOVAT' if license.is_active else 'AKTIVOVAT' }}</button>
                        <button class="action-btn danger" onclick="deleteLicense('{{ license.api_key }}')" title="Smazat licenci">SMAZAT</button>
                        <button class="action-btn primary-btn" data-api-key="{{ license.api_key }}" onclick="openWelcomePackageModal(this)" title="Generovat uv√≠tac√≠ bal√≠ƒçek">INFO BAL√çƒåEK</button>
                        <a href="{{ url_for('admin.user_audit') }}?user={{ license.api_key }}" class="action-btn" title="Audit">Audit</a>
                        <button class="action-btn" data-api-key="{{ license.api_key }}" data-user-display="{{ (license.user_name or license.email or license.api_key)|e }}" onclick="openChangePasswordModal(this)" title="Heslo">Heslo</button>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="7" class="text-center text-muted" style="padding:24px;">≈Ω√°dn√© licence. Kliknƒõte na ‚ÄûNov√° licence‚Äú.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="margin-top:32px;">
    <h2 style="font-size:1.2em;font-weight:600;margin-bottom:12px;">Log Online Dema</h2>
    <p style="color:#6b7280;font-size:0.9em;margin-bottom:12px;">Posledn√≠ pou≈æit√≠ str√°nky Online Check (IP adresa, ƒças, poƒçet soubor≈Ø).</p>
    <div class="table-container">
        <table class="table-dense">
            <thead>
                <tr>
                    <th>IP adresa</th>
                    <th>Poƒçet soubor≈Ø</th>
                    <th>ƒåas</th>
                </tr>
            </thead>
            <tbody>
                {% for row in online_demo_log %}
                <tr>
                    <td>{{ row.ip_address or '‚Äî' }}</td>
                    <td>{{ row.file_count }}</td>
                    <td><small>{{ (row.timestamp or '‚Äî')[:19] }}</small></td>
                </tr>
                {% else %}
                <tr><td colspan="3" class="text-center text-muted" style="padding:24px;">Zat√≠m ≈æ√°dn√© z√°znamy.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="modal-overlay" id="createModal">
    <div class="modal">
        <div class="modal-header">
            <h3>Vytvorit novou licenci</h3>
            <button class="modal-close" onclick="closeModal('createModal')">&times;</button>
        </div>
        <form id="createForm" onsubmit="submitCreateForm(event)">
            <div class="form-group">
                <label for="create_user_name">Jmeno uzivatele</label>
                <input type="text" id="create_user_name" name="user_name" required>
            </div>
            <div class="form-group">
                <label for="create_email">Email</label>
                <input type="email" id="create_email" name="email" required>
            </div>
            <div class="form-group">
                <label for="create_tier_id">Tier</label>
                <select id="create_tier_id" name="tier_id">
                    {% for t in product_tiers or tiers_list %}
                    <option value="{{ t.id }}">{{ t.name }}</option>
                    {% endfor %}
                    {% if not (product_tiers or tiers_list) %}
                    <option value="1">Free</option><option value="2">Basic</option><option value="3">Pro</option><option value="4">Trial</option>
                    {% endif %}
                </select>
            </div>
            <div class="form-group">
                <label for="create_password">Heslo pro uzivatele (pro prihlaseni e-mailem v agentovi ‚Äì bez hesla prihlaseni v agentovi nefunguje)</label>
                <input type="password" id="create_password" name="password" placeholder="Doporuƒçeno vyplnit">
            </div>
            <div class="form-group">
                <label for="create_days">Platnost (dni, prazdne = neomezeno)</label>
                <input type="number" id="create_days" name="days" value="365" min="1">
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('createModal')">Zrusit</button>
                <button type="submit" class="btn btn-primary">Vytvorit</button>
            </div>
        </form>
    </div>
</div>

<div class="modal-overlay" id="editModal">
    <div class="modal" style="max-width:520px;">
        <div class="modal-header">
            <h3>Upravit u≈æivatele</h3>
            <button class="modal-close" onclick="closeModal('editModal')">&times;</button>
        </div>
        <form id="editForm" onsubmit="submitEditForm(event)">
            <input type="hidden" id="edit_api_key" name="api_key">
            <div class="form-group">
                <label for="edit_user_name">Jm√©no</label>
                <input type="text" id="edit_user_name" name="user_name" class="form-control">
            </div>
            <div class="form-group">
                <label for="edit_email">E-mail</label>
                <input type="email" id="edit_email" name="email" class="form-control">
            </div>
            <div class="form-group">
                <label for="edit_tier_id">Tarif (Tier)</label>
                <select id="edit_tier_id" name="tier_id">
                    {% for t in product_tiers or tiers_list %}
                    <option value="{{ t.id }}">{{ t.name }}</option>
                    {% endfor %}
                    {% if not (product_tiers or tiers_list) %}
                    <option value="1">Free</option><option value="2">Basic</option><option value="3">Pro</option><option value="4">Trial</option>
                    {% endif %}
                </select>
            </div>
            <div class="form-group">
                <label for="edit_license_expires">Datum expirace</label>
                <input type="date" id="edit_license_expires" name="license_expires" class="form-control">
            </div>
            <div class="form-group">
                <label for="edit_is_active">Status</label>
                <select id="edit_is_active" name="is_active" class="form-control">
                    <option value="1">Aktivn√≠</option>
                    <option value="0">Blokovan√Ω</option>
                </select>
            </div>
            <div class="form-group">
                <label for="edit_new_password">Nov√© heslo (nevypl≈àovat = beze zmƒõny)</label>
                <input type="password" id="edit_new_password" name="new_password" class="form-control" placeholder="Min. 6 znak≈Ø">
            </div>
            <div class="form-group">
                <label for="edit_payment_method">Zp≈Øsob platby</label>
                <select id="edit_payment_method" name="payment_method" class="form-control">
                    <option value="">‚Äî</option>
                    <option value="Karta">Karta</option>
                    <option value="P≈ôevod">P≈ôevod</option>
                </select>
            </div>
            <div class="form-group">
                <label for="edit_last_payment_date">Datum posledn√≠ platby</label>
                <input type="date" id="edit_last_payment_date" name="last_payment_date" class="form-control">
            </div>
            <div class="form-group">
                <label>Historie fakturace</label>
                <div id="editBillingList" style="max-height:120px;overflow-y:auto;font-size:0.8em;color:#6b7280;margin-top:4px;"></div>
                <button type="button" class="btn btn-secondary btn-sm" style="margin-top:8px;" onclick="openAddBillingModal()">+ P≈ôidat z√°znam</button>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('editModal')">Zru≈°it</button>
                <button type="submit" class="btn btn-primary">Ulo≈æit</button>
            </div>
        </form>
    </div>
</div>

<div class="modal-overlay" id="changePasswordModal">
    <div class="modal">
        <div class="modal-header">
            <h3>Zmenit heslo uzivatele</h3>
            <button class="modal-close" onclick="closeModal('changePasswordModal')">&times;</button>
        </div>
        <p style="margin-bottom:16px;color:#6b7280;">Uzivatel: <strong id="changePasswordUserDisplay"></strong></p>
        <p style="font-size:0.85em;color:#9ca3af;margin-bottom:16px;">Heslo slouzi pro prihlaseni v agentovi (e-mail + heslo). Aktualni heslo nelze zobrazit.</p>
        <form id="changePasswordForm" onsubmit="submitChangePassword(event)">
            <input type="hidden" id="changePasswordApiKey" name="api_key">
            <div class="form-group">
                <label for="changePasswordNew">Nove heslo</label>
                <input type="password" id="changePasswordNew" name="new_password" required minlength="6" placeholder="Min. 6 znaku">
            </div>
            <div class="form-group">
                <label for="changePasswordNew2">Nove heslo znovu</label>
                <input type="password" id="changePasswordNew2" name="new_password2" required minlength="6">
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('changePasswordModal')">Zrusit</button>
                <button type="submit" class="btn btn-primary">Ulozit heslo</button>
            </div>
        </form>
    </div>
</div>

<div class="modal-overlay" id="welcomePackageModal">
    <div class="modal" style="max-width:560px;">
        <div class="modal-header">
            <h3>Generovat uv√≠tac√≠ bal√≠ƒçek</h3>
            <button class="modal-close" onclick="closeModal('welcomePackageModal')">&times;</button>
        </div>
        <p style="margin-bottom:12px;color:#6b7280;font-size:0.9em;">Vygeneruje n√°hodn√© heslo a p≈ôiprav√≠ text e-mailu. Heslo se prop√≠≈°e do √∫ƒçtu.</p>
        <div id="welcomePackageContent" style="background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;padding:12px;font-family:monospace;font-size:0.85em;white-space:pre-wrap;word-break:break-all;max-height:280px;overflow-y:auto;"></div>
        <div class="modal-actions" style="margin-top:16px;">
            <button type="button" class="btn btn-secondary" onclick="closeModal('welcomePackageModal')">Zav≈ô√≠t</button>
            <button type="button" class="btn btn-primary" id="welcomePackageCopyBtn" style="display:none;" onclick="copyWelcomePackageText()">Kop√≠rovat text</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="resultModal">
    <div class="modal">
        <div class="modal-header">
            <h3>Vysledek</h3>
            <button class="modal-close" onclick="closeModal('resultModal')">&times;</button>
        </div>
        <div id="resultContent"></div>
        <div class="modal-actions">
            <button class="btn btn-primary" onclick="closeModal('resultModal'); location.reload();">OK</button>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
function openModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }
function openCreateModal() { document.getElementById('createForm').reset(); openModal('createModal'); }
function openEditModalFromRow(tr) {
    var apiKey = tr.getAttribute('data-api-key');
    var tierId = tr.getAttribute('data-tier-id') || '';
    document.getElementById('edit_api_key').value = apiKey;
    document.getElementById('edit_user_name').value = tr.getAttribute('data-user-name') || '';
    document.getElementById('edit_email').value = tr.getAttribute('data-email') || '';
    document.getElementById('edit_license_expires').value = (tr.getAttribute('data-license-expires') || '').substring(0, 10);
    document.getElementById('edit_is_active').value = tr.getAttribute('data-is-active') === '1' ? '1' : '0';
    document.getElementById('edit_payment_method').value = tr.getAttribute('data-payment-method') || '';
    document.getElementById('edit_last_payment_date').value = (tr.getAttribute('data-last-payment-date') || '').substring(0, 10);
    document.getElementById('edit_new_password').value = '';
    var sel = document.getElementById('edit_tier_id');
    if (tierId && tierId !== 'None') sel.value = tierId;
    else if (sel.options.length) sel.selectedIndex = 0;
    loadBillingHistory(apiKey);
    openModal('editModal');
}
async function loadBillingHistory(apiKey) {
    var el = document.getElementById('editBillingList');
    el.innerHTML = 'Naƒç√≠t√°m‚Ä¶';
    try {
        var r = await fetch('/admin/api/license/billing?api_key=' + encodeURIComponent(apiKey));
        var data = await r.json();
        if (data.success && data.data && data.data.length) {
            el.innerHTML = data.data.map(function(x) {
                return '<div style="padding:4px 0;border-bottom:1px solid #eee;">' + (x.description || '-') + ' ' + (x.amount_cents != null ? x.amount_cents + ' Kƒç' : '') + ' <small>' + (x.paid_at || x.created_at || '').substring(0, 10) + '</small></div>';
            }).join('');
        } else { el.innerHTML = '<span class="text-muted">≈Ω√°dn√© z√°znamy</span>'; }
    } catch (e) { el.innerHTML = '<span style="color:#dc2626;">Chyba naƒçten√≠</span>'; }
}
function openAddBillingModal() {
    var apiKey = document.getElementById('edit_api_key').value;
    var desc = prompt('Popis (nap≈ô. Faktura 2025-01):');
    if (desc === null) return;
    var amount = prompt('ƒå√°stka (Kƒç):', '0');
    if (amount === null) return;
    var paidAt = prompt('Datum platby (YYYY-MM-DD):', new Date().toISOString().substring(0, 10));
    if (paidAt === null) return;
    var fd = new FormData();
    fd.append('api_key', apiKey);
    fd.append('description', desc);
    fd.append('amount_cents', Math.round(parseFloat(amount) || 0) * 100);
    fd.append('paid_at', paidAt);
    fetch('/admin/api/license/billing', { method: 'POST', body: fd }).then(function(r) { return r.json(); }).then(function(res) {
        if (res.success) { loadBillingHistory(apiKey); alert('Z√°znam p≈ôid√°n'); }
        else alert(res.error || 'Chyba');
    }).catch(function(e) { alert('Chyba: ' + e.message); });
}
var lastWelcomePackageText = '';
function openWelcomePackageModal(btn) {
    var apiKey = btn.getAttribute('data-api-key');
    document.getElementById('welcomePackageContent').textContent = 'Naƒç√≠t√°m‚Ä¶';
    document.getElementById('welcomePackageCopyBtn').style.display = 'none';
    openModal('welcomePackageModal');
    var fd = new FormData();
    fd.append('api_key', apiKey);
    fetch('/admin/api/license/welcome-package', { method: 'POST', body: fd })
        .then(function(r) { return r.json(); })
        .then(function(data) {
            lastWelcomePackageText = data.email_body || '';
            document.getElementById('welcomePackageContent').textContent = lastWelcomePackageText || (data.error || 'Chyba');
            document.getElementById('welcomePackageCopyBtn').style.display = lastWelcomePackageText ? 'inline-block' : 'none';
        })
        .catch(function(e) { document.getElementById('welcomePackageContent').textContent = 'Chyba: ' + e.message; });
}
function copyWelcomePackageText() {
    if (lastWelcomePackageText && navigator.clipboard) {
        navigator.clipboard.writeText(lastWelcomePackageText).then(function() { alert('Text zkop√≠rov√°n do schr√°nky.'); });
    }
}
function openChangePasswordModal(btn) {
    var apiKey = btn.getAttribute('data-api-key');
    var display = btn.getAttribute('data-user-display') || apiKey;
    document.getElementById('changePasswordApiKey').value = apiKey;
    document.getElementById('changePasswordUserDisplay').textContent = display;
    document.getElementById('changePasswordForm').reset();
    openModal('changePasswordModal');
}
async function submitChangePassword(e) {
    e.preventDefault();
    var apiKey = document.getElementById('changePasswordApiKey').value;
    var newPass = document.getElementById('changePasswordNew').value;
    var newPass2 = document.getElementById('changePasswordNew2').value;
    if (newPass !== newPass2) { showResult('Hesla se neshoduji', true); return; }
    if (newPass.length < 6) { showResult('Heslo musi mit alespon 6 znaku', true); return; }
    var data = new FormData();
    data.append('api_key', apiKey);
    data.append('new_password', newPass);
    data.append('new_password2', newPass2);
    try {
        var resp = await fetch('/admin/api/license/set-password', { method: 'POST', body: data });
        var result = await resp.json();
        closeModal('changePasswordModal');
        showResult(result.message || result.error, !result.success);
    } catch (err) { showResult('Chyba: ' + err.message, true); }
}
function showResult(message, isError) {
    var content = document.getElementById('resultContent');
    content.innerHTML = '<div class="alert alert-' + (isError ? 'error' : 'success') + '">' + message + '</div>';
    openModal('resultModal');
}
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() { alert('API klic zkopirovan do schranky'); });
}
async function doGitPull() {
    var btn = document.getElementById('btn-git-pull');
    if (btn.disabled) return;
    btn.disabled = true;
    btn.textContent = '... prob√≠h√° ...';
    try {
        var resp = await fetch('{{ url_for("admin.api_git_pull") }}', { method: 'POST', headers: { 'X-Requested-With': 'XMLHttpRequest' } });
        var text = await resp.text();
        var data;
        try {
            data = (text && text.trim().startsWith('{')) ? JSON.parse(text) : { success: false, log: ['Odpovƒõƒè nen√≠ JSON (server mohl vr√°tit 502/500).'] };
        } catch (parseErr) {
            data = { success: false, log: ['Server vr√°til str√°nku m√≠sto JSON. Na PA spus≈•te git pull v Bash a Reload.'] };
        }
        var log = (data.log || []).join('\n');
        alert(data.success ? 'Hotovo.\n\n' + log : 'Chyba:\n\n' + log);
    } catch (e) { alert('Chyba pri volani: ' + e.message); }
    btn.disabled = false;
    btn.textContent = 'üîÑ St√°hnout z GitHubu';
}
async function submitCreateForm(e) {
    e.preventDefault();
    var data = new FormData(document.getElementById('createForm'));
    data.append('tier_id', document.getElementById('create_tier_id').value);
    try {
        var response = await fetch('/admin/api/license/create', { method: 'POST', body: data });
        var result = await response.json();
        if (result.success) {
            closeModal('createModal');
            showResult('<p><strong>Licence vytvorena!</strong></p><p style="margin-top:12px;">API klic:</p><div style="background:#f3f4f6;padding:12px;border-radius:8px;font-family:monospace;word-break:break-all;margin-top:8px;">' + result.api_key + '</div><button class="btn btn-secondary btn-small" style="margin-top:12px;" onclick="copyToClipboard(\'' + result.api_key + '\')">Kopirovat</button>', false);
        } else { showResult(result.error || 'Chyba pri vytvareni', true); }
    } catch (err) { showResult('Chyba: ' + err.message, true); }
}
async function submitEditForm(e) {
    e.preventDefault();
    var data = new FormData(document.getElementById('editForm'));
    var np = document.getElementById('edit_new_password').value;
    if (np) data.set('new_password', np);
    try {
        var response = await fetch('{{ url_for("admin.api_update_license") }}', { method: 'POST', body: data });
        var result = await response.json();
        closeModal('editModal');
        showResult(result.message || result.error, !result.success);
        if (result.success) setTimeout(function() { location.reload(); }, 800);
    } catch (err) { showResult('Chyba: ' + err.message, true); }
}
async function toggleLicense(apiKey, activate) {
    if (!confirm('Opravdu chcete ' + (activate ? 'aktivovat' : 'deaktivovat') + ' tuto licenci?')) return;
    var data = new FormData();
    data.append('api_key', apiKey);
    data.append('is_active', activate ? '1' : '0');
    try {
        var response = await fetch('/admin/api/license/toggle', { method: 'POST', body: data });
        var result = await response.json();
        showResult(result.message || result.error, !result.success);
    } catch (err) { showResult('Chyba: ' + err.message, true); }
}
async function deleteLicense(apiKey) {
    if (!confirm('VAROVANI: Opravdu chcete SMAZAT tuto licenci? Tato akce je nevratna!')) return;
    if (!confirm('Potvrzujete smazani licence?')) return;
    var data = new FormData();
    data.append('api_key', apiKey);
    try {
        var response = await fetch('/admin/api/license/delete', { method: 'POST', body: data });
        var result = await response.json();
        showResult(result.message || result.error, !result.success);
    } catch (err) { showResult('Chyba: ' + err.message, true); }
}
document.querySelectorAll('.modal-overlay').forEach(function(overlay) {
    overlay.addEventListener('click', function(e) {
        if (e.target === overlay) overlay.classList.remove('active');
    });
});
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay.active').forEach(function(modal) { modal.classList.remove('active'); });
    }
});
</script>
{% endblock %}
