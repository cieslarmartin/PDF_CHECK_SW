<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF DokuCheck Admin ‚Äì Logy a audit</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-size: 0.875rem; background: #f0f2f5; }
        .sidebar { width: 220px; background: #1a1d23; min-height: 100vh; padding: 1rem 0; flex-shrink: 0; }
        .sidebar .logo { padding: 0 1rem 1rem; border-bottom: 1px solid #2d323e; margin-bottom: 0.5rem; font-weight: 700; color: #fff; }
        .sidebar .logo span.pdf { color: #3498db; }
        .sidebar a { color: #a0aec0; padding: 0.6rem 1rem; display: flex; align-items: center; gap: 0.5rem; text-decoration: none; }
        .sidebar a:hover { background: #2d323e; color: #fff; }
        .sidebar a.active { background: #2d323e; color: #3498db; }
        .sidebar .nav-icon { font-size: 1.1em; width: 1.5rem; text-align: center; }
        .main { flex: 1; padding: 1.25rem; min-width: 0; }
        .tabs-log .nav-link { color: #4a5568; }
        .tabs-log .nav-link.active { color: #3498db; font-weight: 600; }
        table.table-sm td, table.table-sm th { padding: 0.4rem 0.6rem; vertical-align: middle; }
        .log-user { max-width: 140px; overflow: hidden; text-overflow: ellipsis; font-family: monospace; font-size: 0.8em; }
        .badge-level { font-size: 0.7rem; }
    </style>
</head>
<body class="d-flex">
    <aside class="sidebar">
        <div class="logo"><span class="pdf">PDF</span> DokuCheck</div>
        <a href="{{ url_for('admin.dashboard') }}"><span class="nav-icon">üìä</span> N√°stƒõnka</a>
        <a href="{{ url_for('admin.tiers') }}"><span class="nav-icon">üìã</span> Tier definice</a>
        <a href="{{ url_for('admin.trial') }}"><span class="nav-icon">üß™</span> Trial spr√°va</a>
        <a href="{{ url_for('admin.logs') }}" class="active"><span class="nav-icon">üìú</span> Logy</a>
        <a href="{{ url_for('admin.settings') }}"><span class="nav-icon">‚öôÔ∏è</span> Nastaven√≠</a>
        <div style="margin-top: auto; padding: 1rem; border-top: 1px solid #2d323e;">
            <small class="text-muted">{{ user.email }}</small><br>
            <a href="{{ url_for('admin.logout') }}" class="text-danger small">Odhl√°sit</a>
        </div>
    </aside>
    <main class="main">
        <h1 class="h5 mb-3">Logy a audit</h1>
        <p class="text-muted small mb-3">Syst√©mov√© logy (chyby serveru), u≈æivatelsk√© logy (p≈ôihl√°≈°en√≠, nahr√°n√≠) a platebn√≠ logy (zmƒõny tarif≈Ø).</p>

        <ul class="nav nav-tabs tabs-log mb-3">
            <li class="nav-item">
                <a class="nav-link {{ 'active' if category == 'system' else '' }}" href="{{ url_for('admin.logs', category='system', user_id=user_id, date_from=date_from, date_to=date_to, level=level) }}">Syst√©mov√© logy</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {{ 'active' if category == 'user' else '' }}" href="{{ url_for('admin.logs', category='user', user_id=user_id, date_from=date_from, date_to=date_to, level=level) }}">U≈æivatelsk√© logy</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {{ 'active' if category == 'payment' else '' }}" href="{{ url_for('admin.logs', category='payment', user_id=user_id, date_from=date_from, date_to=date_to, level=level) }}">Platebn√≠ logy</a>
            </li>
        </ul>

        <form method="get" class="row g-2 mb-3">
            <input type="hidden" name="category" value="{{ category }}">
            <div class="col-auto">
                <input type="date" name="date_from" class="form-control form-control-sm" placeholder="Od" value="{{ date_from }}">
            </div>
            <div class="col-auto">
                <input type="date" name="date_to" class="form-control form-control-sm" placeholder="Do" value="{{ date_to }}">
            </div>
            {% if category == 'system' %}
            <div class="col-auto">
                <select name="level" class="form-select form-select-sm" style="width:auto">
                    <option value="">V≈°echny √∫rovnƒõ</option>
                    <option value="INFO" {{ 'selected' if level == 'INFO' else '' }}>INFO</option>
                    <option value="WARNING" {{ 'selected' if level == 'WARNING' else '' }}>WARNING</option>
                    <option value="ERROR" {{ 'selected' if level == 'ERROR' else '' }}>ERROR</option>
                </select>
            </div>
            {% endif %}
            <div class="col-auto">
                <input type="text" name="user_id" class="form-control form-control-sm" style="max-width:180px" placeholder="User ID (api_key)" value="{{ user_id }}">
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-sm btn-primary">Filtrovat</button>
            </div>
        </form>

        <div class="table-responsive">
            <table class="table table-sm table-bordered bg-white">
                <thead class="table-light">
                    {% if category == 'system' %}
                    <tr><th>ƒåas</th><th>√örove≈à</th><th>Zpr√°va</th><th>User</th></tr>
                    {% elif category == 'payment' %}
                    <tr><th>ƒåas</th><th>User</th><th>Akce</th><th>Detail</th></tr>
                    {% else %}
                    <tr><th>ƒåas</th><th>User</th><th>Akce</th><th>V√Ωsledek</th><th>IP / stroj</th></tr>
                    {% endif %}
                </thead>
                <tbody>
                    {% for log in logs_list %}
                    <tr>
                        {% if category == 'system' %}
                        <td>{{ log.timestamp[:19] if log.timestamp else '-' }}</td>
                        <td><span class="badge badge-level bg-{{ 'info' if log.level == 'INFO' else ('warning' if log.level == 'WARNING' else 'danger') }}">{{ log.level }}</span></td>
                        <td>{{ log.message or '-' }}</td>
                        <td class="log-user" title="{{ log.user_id or '' }}">{{ (log.user_id or '-')[:20] }}{% if log.user_id and log.user_id|length > 20 %}‚Ä¶{% endif %}</td>
                        {% elif category == 'payment' %}
                        <td>{{ log.timestamp[:19] if log.timestamp else '-' }}</td>
                        <td class="log-user" title="{{ log.user_id }}">{{ log.user_id[:20] }}‚Ä¶</td>
                        <td>{{ log.action }}</td>
                        <td>{{ log.details or '-' }}</td>
                        {% else %}
                        <td>{{ log.timestamp[:19] if log.timestamp else '-' }}</td>
                        <td class="log-user" title="{{ log.user_id }}">{{ log.user_id[:16] }}‚Ä¶</td>
                        <td>{{ log.action_type }}</td>
                        <td>{{ log.status }} {% if log.file_count %}({{ log.file_count }} soub.){% endif %}</td>
                        <td>{{ log.ip_address or '-' }} {% if log.machine_id %}<br><small class="text-muted">{{ log.machine_id[:12] }}‚Ä¶</small>{% endif %}</td>
                        {% endif %}
                    </tr>
                    {% else %}
                    <tr><td colspan="5" class="text-center text-muted py-4">≈Ω√°dn√© z√°znamy</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>
</body>
</html>
